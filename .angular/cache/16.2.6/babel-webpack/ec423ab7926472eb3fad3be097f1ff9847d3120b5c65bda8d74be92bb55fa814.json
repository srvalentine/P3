{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/Duoc/Desktop/master/carlos_rama/P3/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../auth.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@ionic/storage-angular\";\nimport * as i4 from \"../services/location.service\";\nimport * as i5 from \"@ionic-native/geolocation/ngx\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@ionic/angular\";\nfunction AsistenciaPage_img_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 9);\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"src\", ctx_r0.selfieImageSrc, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction AsistenciaPage_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10)(1, \"ion-text\", 11);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\")(4, \"ion-text\", 12);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(6, \"br\");\n    i0.ɵɵelementStart(7, \"ion-text\", 12);\n    i0.ɵɵtext(8, \"------------------------\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"Hola, \", ctx_r1.loggedInUser.name, \" \", ctx_r1.loggedInUser.lname, \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Rut: \", ctx_r1.loggedInUser.rut, \"\");\n  }\n}\nfunction AsistenciaPage_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10)(1, \"ion-text\", 11);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"br\");\n    i0.ɵɵelementStart(4, \"ion-text\", 11);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(6, \"br\");\n    i0.ɵɵelementStart(7, \"ion-text\", 11);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(9, \"br\");\n    i0.ɵɵelementStart(10, \"ion-text\", 11);\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(12, \"br\");\n    i0.ɵɵelementStart(13, \"ion-text\", 12);\n    i0.ɵɵtext(14, \"------------------------\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(15, \"br\");\n    i0.ɵɵelementStart(16, \"ion-text\", 13);\n    i0.ɵɵtext(17, \"Coordenadas:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(18, \"br\");\n    i0.ɵɵelementStart(19, \"ion-text\", 13);\n    i0.ɵɵtext(20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(21, \"br\");\n    i0.ɵɵelementStart(22, \"ion-text\", 13);\n    i0.ɵɵtext(23);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Profesor: \", ctx_r2.qrData.profesor, \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Hora de Clase: \", ctx_r2.qrData.horaclase, \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Sala: \", ctx_r2.qrData.sala, \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Dia: \", ctx_r2.qrData.dia, \"\");\n    i0.ɵɵadvance(9);\n    i0.ɵɵtextInterpolate1(\"Latitud: \", ctx_r2.latitud, \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Longitud: \", ctx_r2.longitud, \" \");\n  }\n}\nlet AsistenciaPage = /*#__PURE__*/(() => {\n  class AsistenciaPage {\n    constructor(authService, router, route, storage, locationService, geolocation) {\n      this.authService = authService;\n      this.router = router;\n      this.route = route;\n      this.storage = storage;\n      this.locationService = locationService;\n      this.geolocation = geolocation;\n      this.loggedInUser = null;\n      this.regionName = '';\n      this.comunaName = '';\n      this.latitud = 0;\n      this.longitud = 0;\n      this.selfieImageSrc = null;\n    }\n    iraInicio() {\n      this.authService.logout();\n      this.router.navigate(['/home']);\n    }\n    ngOnInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        yield _this.storage.create();\n        const datosUsuario = yield _this.storage.get('usuarioLogg');\n        if (datosUsuario) {\n          _this.loggedInUser = datosUsuario;\n        }\n        _this.route.queryParams.subscribe(params => {\n          if (params && params['qrData']) {\n            _this.qrData = JSON.parse(params['qrData']);\n          }\n        });\n      })();\n    }\n    obtenerUbicacion() {\n      this.geolocation.getCurrentPosition().then(resp => {\n        this.latitud = resp.coords.latitude;\n        this.longitud = resp.coords.longitude;\n      }).catch(error => {\n        console.error('Error obteniendo la ubicación', error);\n      });\n    }\n    ionViewDidEnter() {\n      this.tomarSelfie();\n      this.obtenerUbicacion();\n    }\n    tomarSelfie() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const stream = yield navigator.mediaDevices.getUserMedia({\n            video: true\n          });\n          const video = document.createElement('video');\n          video.srcObject = stream;\n          video.setAttribute('playsinline', 'true');\n          video.play();\n          video.addEventListener('loadeddata', () => {\n            const canvas = document.createElement('canvas');\n            canvas.width = video.videoWidth;\n            canvas.height = video.videoHeight;\n            const context = canvas.getContext('2d');\n            context.drawImage(video, 0, 0, canvas.width, canvas.height);\n            _this2.selfieImageSrc = canvas.toDataURL('image/png');\n            stream.getTracks().forEach(track => track.stop());\n            video.remove();\n            canvas.remove();\n          });\n        } catch (error) {\n          console.error('Error al tomar la selfie');\n        }\n      })();\n    }\n    static #_ = this.ɵfac = function AsistenciaPage_Factory(t) {\n      return new (t || AsistenciaPage)(i0.ɵɵdirectiveInject(i1.AuthService), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i3.Storage), i0.ɵɵdirectiveInject(i4.LocationService), i0.ɵɵdirectiveInject(i5.Geolocation));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AsistenciaPage,\n      selectors: [[\"app-asistencia\"]],\n      decls: 14,\n      vars: 3,\n      consts: [[1, \"ion-padding\"], [1, \"ion-text-center\", \"ion-padding\"], [1, \"titulo_principal\"], [1, \"ion-text-center\"], [1, \"titulo_secundario\"], [\"alt\", \"Selfie\", 3, \"src\", 4, \"ngIf\"], [\"class\", \"ion-text-start\", 4, \"ngIf\"], [1, \"div_volver\"], [1, \"link_volver\", 3, \"click\"], [\"alt\", \"Selfie\", 3, \"src\"], [1, \"ion-text-start\"], [1, \"usuario\"], [1, \"rut_usuario\"], [1, \"coordenadas\"]],\n      template: function AsistenciaPage_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"ion-content\", 0)(1, \"div\", 1)(2, \"ion-text\", 2);\n          i0.ɵɵtext(3, \"Vault-Tec\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(4, \"div\", 3)(5, \"ion-text\", 4);\n          i0.ɵɵtext(6, \"Clase registrada\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(7, \"div\", 1);\n          i0.ɵɵtemplate(8, AsistenciaPage_img_8_Template, 1, 1, \"img\", 5);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(9, AsistenciaPage_div_9_Template, 9, 3, \"div\", 6);\n          i0.ɵɵtemplate(10, AsistenciaPage_div_10_Template, 24, 6, \"div\", 6);\n          i0.ɵɵelementStart(11, \"div\", 7)(12, \"a\", 8);\n          i0.ɵɵlistener(\"click\", function AsistenciaPage_Template_a_click_12_listener() {\n            return ctx.iraInicio();\n          });\n          i0.ɵɵtext(13, \"Cerrar sesi\\u00F3n y volver al inicio\");\n          i0.ɵɵelementEnd()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(8);\n          i0.ɵɵproperty(\"ngIf\", ctx.selfieImageSrc);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.loggedInUser);\n          i0.ɵɵadvance(1);\n          i0.ɵɵproperty(\"ngIf\", ctx.qrData);\n        }\n      },\n      dependencies: [i6.NgIf, i7.IonContent, i7.IonText],\n      styles: [\".titulo_principal[_ngcontent-%COMP%]{font-size:55px}.titulo_secundario[_ngcontent-%COMP%]{font-size:25px;margin-top:3px}.usuario[_ngcontent-%COMP%], .coordenadas[_ngcontent-%COMP%], .rut-usuario[_ngcontent-%COMP%]{font-size:20px;text-align:left}.div_volver[_ngcontent-%COMP%]{position:absolute;margin-top:75px;left:0;padding:10px}.link_volver[_ngcontent-%COMP%]{color:#fff;text-decoration:none}\"]\n    });\n  }\n  return AsistenciaPage;\n})();\nexport { AsistenciaPage };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}